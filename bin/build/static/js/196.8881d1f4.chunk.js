"use strict";(self.webpackChunknagamas_frontend=self.webpackChunknagamas_frontend||[]).push([[196],{1233:(e,r,a)=>{a.d(r,{e:()=>t,w:()=>n});var i=a(8443),o=a(2340);class t{static async GetMachineConfig(e){let r=`${i.C}/api/extension/following_error/v1/machine`;null!=e&&(r+=`?machine_id=${e}`);const a=await o.A.fetchAuth(r);if(200!==a.status)throw new Error(a.message);if(!Array.isArray(a.data))throw new Error("invalid machine config response");for(let i=0;i<a.data.length;i++){var t,n;const e=a.data[i];if("number"!=typeof e.machine_id)throw new Error("invalid machine_id value");if("number"!=typeof(null!==(t=e.following_error_warn)&&void 0!==t?t:0))throw new Error("invalid following_error_warn value");if("number"!=typeof(null!==(n=e.following_error_alarm)&&void 0!==n?n:0))throw new Error("invalid following_error_alarm value")}return a.data}static async UpsertMachineConfig(e,r){const a=await o.A.fetchAuth(`${i.C}/api/extension/following_error/v1/machine`,{method:"PATCH",body:JSON.stringify({machine_id:e,fields:r}),headers:{"Content-Type":"application/json"}});if(200!==a.status)throw new Error(a.message);return a}}class n{static async DashboardLevel1(e,r){const a=await o.A.fetchAuth(`${i.C}/api/extension/following_error/v1/l1?start_date=${e}&end_date=${r}`);if(200!==a.status)throw new Error(a.message);const t=Array.isArray(a.data)?a.data:[];for(let i=0;i<t.length;i++){if("number"!=typeof t[i].business_unit_id)throw new Error("invalid business_unit_id value");if("string"!=typeof t[i].business_unit)throw new Error("invalid business_unit value");if(!Array.isArray(t[i].machine_ool_following_error))throw new Error("invalid machine_ool_following_error value");if("number"!=typeof t[i].ool_following_error)throw new Error("invalid ool_following_error value")}return t}static async DashboardLevel2(e,r,a){const t=await o.A.fetchAuth(`${i.C}/api/extension/following_error/v1/l2?business_unit_id=${a}&start_date=${e}&end_date=${r}`);if(200!==t.status)throw new Error(t.message);const n=Array.isArray(t.data)?t.data:[];for(let i=0;i<n.length;i++){if("number"!=typeof n[i].link_up_id)throw new Error("invalid link_up_id value");if("string"!=typeof n[i].link_up)throw new Error("invalid link_up value");if(!Array.isArray(n[i].machine_ool_following_error))throw new Error("invalid machine_ool_following_error value");if("number"!=typeof n[i].ool_following_error)throw new Error("invalid ool_following_error value")}return n}static async DashboardLevel3(e,r,a){const t=await o.A.fetchAuth(`${i.C}/api/extension/following_error/v1/l3?link_up_id=${a}&start_date=${e}&end_date=${r}`);if(200!==t.status)throw new Error(t.message);const n=Array.isArray(t.data)?t.data:[];for(let i=0;i<n.length;i++){if("number"!=typeof n[i].machine_id)throw new Error("invalid machine_id value");if("number"!=typeof n[i].ool_following_error)throw new Error("invalid ool_following_error value")}return n}static async DashboardLevel4(e,r,a){const t=await o.A.fetchAuth(`${i.C}/api/extension/following_error/v1/data?machine_id=${a}&start_date=${e}&end_date=${r}`);if(200!==t.status)throw new Error(t.message);const n=Array.isArray(t.data)?t.data:[];for(let i=0;i<n.length;i++){if("number"!=typeof n[i].following_error)throw new Error("invalid following_error value");if(void 0!=n[i].following_error_warn&&"number"!=typeof n[i].following_error_warn)throw new Error("invalid following_error_warn value");if(void 0!=n[i].following_error_alarm&&"number"!=typeof n[i].following_error_alarm)throw new Error("invalid following_error_alarm value");if("Invalid Date"==new Date(n[i].created_at).toString())throw new Error("invalid created_at value");n[i].created_at=new Date(n[i].created_at)}return n}static async DashboardLevel1Realtime(){const e=await o.A.fetchAuth(`${i.C}/api/extension/following_error/v1/l1/realtime`);if(200!==e.status)throw new Error(e.message);const r=Array.isArray(e.data)?e.data:[];for(let a=0;a<r.length;a++){if("number"!=typeof r[a].business_unit_id)throw new Error("invalid business_unit_id value");if("string"!=typeof r[a].business_unit)throw new Error("invalid business_unit value");if(!Array.isArray(r[a].machine_ool_following_error))throw new Error("invalid machine_ool_following_error value");if("number"!=typeof r[a].ool_following_error)throw new Error("invalid ool_following_error value")}return r}static async DashboardLevel2Realtime(e){const r=await o.A.fetchAuth(`${i.C}/api/extension/following_error/v1/l2/realtime?business_unit_id=${e}`);if(200!==r.status)throw new Error(r.message);const a=Array.isArray(r.data)?r.data:[];for(let i=0;i<a.length;i++){if("number"!=typeof a[i].link_up_id)throw new Error("invalid link_up_id value");if("string"!=typeof a[i].link_up)throw new Error("invalid link_up value");if(!Array.isArray(a[i].machine_ool_following_error))throw new Error("invalid machine_ool_following_error value");if("number"!=typeof a[i].ool_following_error)throw new Error("invalid ool_following_error value")}return a}static async DashboardLevel3Realtime(e){const r=await o.A.fetchAuth(`${i.C}/api/extension/following_error/v1/l3/realtime?link_up_id=${e}`);if(200!==r.status)throw new Error(r.message);const a=Array.isArray(r.data)?r.data:[];for(let i=0;i<a.length;i++){if("number"!=typeof a[i].machine_id)throw new Error("invalid machine_id value");if("number"!=typeof a[i].ool_following_error)throw new Error("invalid ool_following_error value")}return a}static async DashboardLevel4Realtime(e){const r=await o.A.fetchAuth(`${i.C}/api/extension/following_error/v1/data/realtime?machine_id=${e}`);if(200!==r.status)throw new Error(r.message);const a=Array.isArray(r.data)?r.data:[];for(let i=0;i<a.length;i++){if("number"!=typeof a[i].following_error)throw new Error("invalid following_error value");if(void 0!=a[i].following_error_warn&&"number"!=typeof a[i].following_error_warn)throw new Error("invalid following_error_warn value");if(void 0!=a[i].following_error_alarm&&"number"!=typeof a[i].following_error_alarm)throw new Error("invalid following_error_alarm value");if("Invalid Date"==new Date(a[i].created_at).toString())throw new Error("invalid created_at value");a[i].created_at=new Date(a[i].created_at)}return a}}},3950:(e,r,a)=>{a.d(r,{t:()=>t});var i=a(8443),o=a(2340);class t{static async GetAllMachine(e){let r=`${i.C}/api/v1/machine`;null!=e&&(r+=`?link_up_id=${e}`);const a=await o.A.fetchAuth(r);if(200!==a.status)throw new Error(a.message);const t=Array.isArray(a.data)?a.data:[],n=[];for(let i=0;i<t.length;i++)n.push({machine_id:t[i].machine_id,machine:t[i].machine,machine_warn:t[i].machine_warn,machine_alarm:t[i].machine_alarm,link_up:t[i].link_up,machine_type:t[i].machine_type,gateway_host:t[i].gateway_host,gateway_port:t[i].gateway_port,pressure_slave_id:t[i].pressure_slave_id,vibration_slave_id:t[i].vibration_slave_id});return n}static async AddMachine(e){let r=await o.A.fetchAuth(`${i.C}/api/v1/machine`,{method:"POST",body:JSON.stringify({...e}),headers:{"Content-Type":"application/json"}});if(200!==r.status)throw new Error(r.message);return r}static async UpdateMachine(e,r){let a=await o.A.fetchAuth(`${i.C}/api/v1/machine`,{method:"PATCH",body:JSON.stringify({machine_id:e,fields:r}),headers:{"Content-Type":"application/json"}});if(200!==a.status)throw new Error(a.message);return a}static async DeleteMachine(e){let r=await o.A.fetchAuth(`${i.C}/api/v1/machine`,{method:"DELETE",body:JSON.stringify({machine_id:e}),headers:{"Content-Type":"application/json"}});if(200!==r.status)throw new Error(r.message);return r}}},4866:(e,r,a)=>{a.r(r),a.d(r,{default:()=>w});var i=a(5043),o=a(2573),t=a(3216),n=a(3950),l=a(414),s=a(6094),d=a(1121);const c=a.p+"static/media/error_image.60356dd7b68d5ecefdf9.png";var h=a(1233),_=a(8557),f=a(579);const w=e=>{let{realtime:r,refresh:a,filterDate:w,onFilterDateChange:m}=e;const u=(0,i.useContext)(o.A),g=u.version,v=u.contextAccessToken,y=u.contextShowAlertFunc,p=u.contextShowLoadingFunc,A=(u.stateShowLoading,(0,t.Zp)()),b=(0,t.zy)(),{linkUpId:E}=(0,t.g)(),{link_up:x}=b.state||{},[j,k]=(0,i.useState)({}),[$,C]=(0,i.useState)({}),[N,D]=(0,i.useState)({}),O=async()=>{try{if(E){let e=[];if(r)e=await h.w.DashboardLevel3Realtime(Number(E)),m({start_date:new Date,end_date:new Date}),localStorage.removeItem("cache");else{const a=(0,d.Yq)(w.start_date,"yyyy-MM-dd"),i=(0,d.Yq)(w.end_date,"yyyy-MM-dd");e=await h.w.DashboardLevel3(a,i,Number(E)),localStorage.setItem("cache",JSON.stringify({...w,realtime:r}))}const a={},i={};for(let r=0;r<e.length;r++){const o=e[r];a[`${o.machine_id}`]=o;const t=Object.values(j).flat().find(e=>e.machine_id===o.machine_id);if(!t)continue;const n=t.machine_type;i[n]||(i[n]={link_up_id:x.link_up_id,link_up:x.link_up,ool_following_error:0,machine_ool:[]}),i[n].ool_following_error+=o.ool_following_error,o.ool_following_error>t.machine_alarm&&i[n].machine_ool.push(t.machine_id)}for(const r in i)i[r].machine_ool=Array.from(new Set(i[r].machine_ool));D(i),C(a)}}catch(e){y(new l.u({message:e instanceof Error?e.message:e.toString(),level:3}))}},L=(e,r)=>{const a=null!==e&&void 0!==e?e:0;let i="";return a>r.machine_warn&&(i=s.A.warningBackground),a>r.machine_alarm&&(i=s.A.dangerBackground),i},S=async()=>{if(r)void 0!=g.following&&await O();else{T(),p(!0);const e=[];void 0!=g.following&&e.push(O());try{await Promise.any(e)}catch{}p(!1)}},T=()=>{D(e=>{const r={};for(const a in e)r[a]={...e[a],ool_following_error:0,machine_ool:[]};return r}),C({})};return(0,i.useEffect)(()=>{if(Object.keys(j).length>0&&(S(),r)){let e=null;const r=()=>{e=setTimeout(async()=>{await S(),r()},3e3)};return r(),()=>{null!=e&&clearTimeout(e)}}},[v,r,E,j,a]),(0,i.useEffect)(()=>{(async()=>{0==Object.keys(j).length&&p(!0);try{let e=await n.t.GetAllMachine(E);if(null!=g.following){const r=await h.e.GetMachineConfig();e=e.filter(e=>null!=r.find(r=>r.machine_id==e.machine_id))}const r={};for(let a=0;a<e.length;a++)void 0==r[e[a].machine_type]&&(r[e[a].machine_type]=[]),r[e[a].machine_type].push(e[a]);k(r)}catch(e){y(new l.u({message:e instanceof Error?e.message:e.toString(),level:3}))}finally{0==Object.keys(j).length&&p(!1)}})()},[]),0===Object.keys(j).length?(0,f.jsx)("div",{className:s.A.noData,children:(0,f.jsxs)("div",{className:"flex flex-col items-center justify-center text-gray-400",children:[(0,f.jsx)("img",{src:_,alt:"no_data_img",width:140,height:140}),(0,f.jsx)("p",{className:"mt-2 text-xl font-medium",children:"No Data Available"})]})}):(0,f.jsx)("div",{className:s.A.cardWrapper,style:{gridTemplateColumns:1===Object.keys(j).length?"1fr":"repeat(2, 1fr)",gridAutoRows:Object.keys(j).length<=2?"1fr":void 0},children:Object.keys(j).map(e=>{var r,a,i,o;const t=j[e];return(0,f.jsxs)("div",{className:s.A.cardParent,children:[(0,f.jsxs)("div",{className:s.A.cardParentHeader,children:[(0,f.jsxs)("div",{className:s.A.titleHeader,children:[e," Overall"]}),(0,f.jsxs)("div",{className:s.A.bodyHeader,children:[(0,f.jsxs)("div",{className:s.A.bodyHeaderLeft,children:[(0,f.jsxs)("div",{className:s.A.itemHeaderLeft,children:[(0,f.jsx)("div",{children:"Total Machine OOL"}),(0,f.jsx)("div",{className:s.A.oolNumber,children:null!==(r=null===(a=N[e])||void 0===a||null===(i=a.machine_ool)||void 0===i?void 0:i.length)&&void 0!==r?r:0})]}),(0,f.jsxs)("div",{className:s.A.itemHeaderLeft,children:[(0,f.jsx)("div",{children:"Total OOL Following Error"}),(0,f.jsx)("div",{className:s.A.oolNumber,children:null===(o=N[e])||void 0===o?void 0:o.ool_following_error})]})]}),(0,f.jsx)("div",{className:s.A.bodyHeaderRight,children:(0,f.jsx)("div",{className:s.A.imgWrapper,children:(0,f.jsx)("img",{src:c,alt:"following error image",className:s.A.imgHeader})})})]})]}),(0,f.jsx)("div",{className:s.A.cardParentBodyWrapper,children:(0,f.jsx)("div",{className:s.A.cardParentBody,style:{gridTemplateColumns:Object.keys(j).length>1?"repeat(2, 1fr)":"repeat(4, 1fr)"},children:t.map(e=>{const r=$[`${e.machine_id}`];return(0,f.jsx)(f.Fragment,{children:r&&(0,f.jsxs)("div",{className:s.A.gridItem,onClick:()=>A(`/dashboard/l4/${e.machine_id}`,{state:{dashboard_type:"follerr",machine:e.machine}}),children:[(0,f.jsx)("div",{className:s.A.gridTitle,children:(0,f.jsx)("div",{className:s.A.gridTitleText,children:e.machine})}),(0,f.jsx)("div",{className:s.A.gridContentFoll,children:(0,f.jsxs)("div",{className:`${s.A.gridContentTextFoll} ${L(r.ool_following_error,e)}`,style:{gridColumn:"span 2"},children:[(0,f.jsx)("div",{children:"OOL Following Error"}),(0,f.jsx)("div",{children:r.ool_following_error})]})})]},e.machine_id)})})})})]},e)})})}},8557:(e,r,a)=>{e.exports=a.p+"static/media/no_data_image.02a3677960f597d7be3c.png"}}]);
//# sourceMappingURL=196.8881d1f4.chunk.js.map