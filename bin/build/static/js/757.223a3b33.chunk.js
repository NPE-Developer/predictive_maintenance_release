"use strict";(self.webpackChunknagamas_frontend=self.webpackChunknagamas_frontend||[]).push([[757],{2087:(e,r,t)=>{t.d(r,{A:()=>o});var s=t(1121),a=t(9223),n=t.n(a);const o=class{static export(e,r,t){const s=new(n().Workbook),a=s.addWorksheet(e),o=e=>e>=0&&e<=51?["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","AA","AB","AC","AD","AE","AF","AG","AH","AI","AJ","AK","AL","AM","AN","AO","AP","AQ","AR","AS","AT","AU","AV","AW","AX","AY","AZ"][e]:"Invalid number";r.map((e,r)=>{a.getColumn(`${o(r)}`).width=20,a.getCell(`${o(r)}1`).value=String(e.toUpperCase()),a.getCell(`${o(r)}1`).style={fill:{type:"pattern",pattern:"solid",fgColor:{argb:"c8c8c8"}},font:{bold:!0},alignment:{vertical:"middle",horizontal:"center"},border:{top:{style:"thin",color:{argb:"000000"}},left:{style:"thin",color:{argb:"000000"}},right:{style:"thin",color:{argb:"000000"}},bottom:{style:"thin",color:{argb:"000000"}}}}}),t.map((e,t)=>{const s=[];r.map(r=>{null!=e[r]?s.push(e[r]):s.push("")});a.addRow(s).eachCell(e=>{e.style={alignment:{vertical:"middle",horizontal:"center"},border:{top:{style:"thin",color:{argb:"000000"}},left:{style:"thin",color:{argb:"000000"}},right:{style:"thin",color:{argb:"000000"}},bottom:{style:"thin",color:{argb:"000000"}}}}})}),s.xlsx.writeBuffer().then(r=>{const t=new Blob([r],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),s=document.createElement("a");s.href=window.URL.createObjectURL(t),s.download=`${e}.xlsx`,s.click(),window.URL.revokeObjectURL(s.href)})}static async import(e){const r=new(n().Workbook);await r.xlsx.load(e);const t=[];if(r.eachSheet(e=>{const r=[];e.eachRow(e=>{r.push(e.values)}),t.push(r)}),t.length>0){const e=t[0],r=[];for(let t=1;t<e.length;t++){const n={};for(let r=0;r<e[t].length;r++){var a;if(null!=e[0][r]&&"string"==typeof e[0][r])if(e[t][r]instanceof Date)n[e[0][r].toLowerCase()]=(0,s.GP)(e[t][r],"yyyy-MM-dd HH:mm:ss");else n[e[0][r].toLowerCase()]="object"==typeof e[t][r]?e[t][r].result:null!==(a=e[t][r])&&void 0!==a?a:""}r.push(n)}return r}return[]}}},5175:(e,r,t)=>{t.d(r,{I:()=>n,r:()=>o});var s=t(8443),a=t(2340);class n{static async GetDashboardLevel1(e,r){const t=await a.A.fetchAuth(`${s.C}/api/v1/dashboard/l1?start_date=${encodeURIComponent(e)}&end_date=${encodeURIComponent(r)}`);if(200!==t.status)throw new Error("Failed to fetch dashboard data.");const n=[];for(let s=0;s<t.data.length;s++){const e=t.data[s];if(!Array.isArray(e.machine_ool_pressure))throw new Error("invalid ool pressure data");if(!Array.isArray(e.machine_ool_vibration))throw new Error("invalid ool vibration data");n.push({business_unit_id:e.business_unit_id,business_unit:e.business_unit,business_unit_warn:e.business_unit_warn,business_unit_alarm:e.business_unit_alarm,ool_pressure:e.ool_pressure,ool_vibration:e.ool_vibration,ool_temperature:e.ool_temperature,machine_ool_pressure:e.machine_ool_pressure,machine_ool_vibration:e.machine_ool_vibration,sensor_vibration_connected:e.sensor_vibration_connected,sensor_vibration_total:e.sensor_vibration_total,sensor_pressure_connected:e.sensor_pressure_connected,sensor_pressure_total:e.sensor_pressure_total})}return n}static async GetDashboardLevel2(e,r,t){const n=await a.A.fetchAuth(`${s.C}/api/v1/dashboard/l2?business_unit_id=${encodeURIComponent(e)}&start_date=${encodeURIComponent(r)}&end_date=${encodeURIComponent(t)}`);if(200!==n.status)throw new Error("Failed to fetch dashboard data.");const o=[];for(let s=0;s<n.data.length;s++){const e=n.data[s];if(!Array.isArray(e.machine_ool_pressure))throw new Error("invalid ool pressure data");if(!Array.isArray(e.machine_ool_vibration))throw new Error("invalid ool vibration data");o.push({link_up_id:e.link_up_id,link_up:e.link_up,link_up_warn:e.link_up_warn,link_up_alarm:e.link_up_alarm,ool_pressure:e.ool_pressure,ool_vibration:e.ool_vibration,ool_temperature:e.ool_temperature,machine_ool_pressure:e.machine_ool_pressure,machine_ool_vibration:e.machine_ool_vibration,sensor_vibration_connected:e.sensor_vibration_connected,sensor_vibration_total:e.sensor_vibration_total,sensor_pressure_connected:e.sensor_pressure_connected,sensor_pressure_total:e.sensor_pressure_total})}return o}static async GetDashboardLevel3(e,r,t){const n=await a.A.fetchAuth(`${s.C}/api/v1/dashboard/l3?link_up_id=${encodeURIComponent(e)}&start_date=${encodeURIComponent(r)}&end_date=${encodeURIComponent(t)}`);if(200!==n.status)throw new Error("Failed to fetch dashboard data.");const o=[];for(let s=0;s<n.data.length;s++){const e=n.data[s];o.push({machine_id:e.machine_id,machine:e.machine,machine_warn:e.machine_warn,machine_alarm:e.machine_alarm,machine_type:e.machine_type,ool_pressure:e.ool_pressure,ool_vibration:e.ool_vibration,ool_temperature:e.ool_temperature,sensor_vibration_connected:e.sensor_vibration_connected,sensor_pressure_connected:e.sensor_pressure_connected})}return o}static async GetDashboardLevel4Pressure(e,r,t){let n=await a.A.fetchAuth(`${s.C}/api/v1/dashboard/pressure/l4?machine_id=${encodeURIComponent(e)}&start_date=${encodeURIComponent(r)}&end_date=${encodeURIComponent(t)}`);if(200!==n.status)throw new Error(n.message);const o=Array.isArray(n.data)?n.data:[],i=[];for(let s=0;s<o.length;s++)i.push({pressure:o[s].pressure,pressure_max_alarm:o[s].pressure_max_alarm,pressure_max_warn:o[s].pressure_max_warn,pressure_min_alarm:o[s].pressure_min_alarm,pressure_min_warn:o[s].pressure_min_warn,timestamp:o[s].timestamp});return i}static async GetDashboardLevel4Vibration(e,r,t){let n=await a.A.fetchAuth(`${s.C}/api/v1/dashboard/vibration/l4?machine_id=${encodeURIComponent(e)}&start_date=${encodeURIComponent(r)}&end_date=${encodeURIComponent(t)}`);if(200!==n.status)throw new Error(n.message);const o=Array.isArray(n.data)?n.data:[],i=[];for(let s=0;s<o.length;s++)i.push({x:o[s].x,x_base:o[s].x_base,x_warn:o[s].x_warn,x_alarm:o[s].x_alarm,z:o[s].z,z_base:o[s].z_base,z_warn:o[s].z_warn,z_alarm:o[s].z_alarm,x_acc:o[s].x_acc,x_acc_base:o[s].x_acc_base,x_acc_warn:o[s].x_acc_warn,x_acc_alarm:o[s].x_acc_alarm,z_acc:o[s].z_acc,z_acc_base:o[s].z_acc_base,z_acc_warn:o[s].z_acc_warn,z_acc_alarm:o[s].z_acc_alarm,temp:o[s].temp,temp_warn:o[s].temp_warn,temp_alarm:o[s].temp_alarm,timestamp:o[s].timestamp});return i}}class o{static async GetDashboardLevel1(){const e=await a.A.fetchAuth(`${s.C}/api/v1/dashboard/realtime/l1`);if(200!==e.status)throw new Error("Failed to fetch dashboard data.");const r=[];for(let t=0;t<e.data.length;t++){const s=e.data[t];if(!Array.isArray(s.machine_ool_pressure))throw new Error("invalid ool pressure data");if(!Array.isArray(s.machine_ool_vibration))throw new Error("invalid ool vibration data");const a=s.machine_ool_pressure.concat(s.machine_ool_vibration);Array.from(new Set(a));r.push({business_unit_id:s.business_unit_id,business_unit:s.business_unit,business_unit_warn:s.business_unit_warn,business_unit_alarm:s.business_unit_alarm,ool_pressure:s.ool_pressure,ool_vibration:s.ool_vibration,ool_temperature:s.ool_temperature,machine_ool_pressure:s.machine_ool_pressure,machine_ool_vibration:s.machine_ool_vibration,sensor_vibration_connected:s.sensor_vibration_connected,sensor_vibration_total:s.sensor_vibration_total,sensor_pressure_connected:s.sensor_pressure_connected,sensor_pressure_total:s.sensor_pressure_total})}return r}static async GetDashboardLevel2(e){const r=await a.A.fetchAuth(`${s.C}/api/v1/dashboard/realtime/l2?business_unit_id=${encodeURIComponent(e)}`);if(200!==r.status)throw new Error("Failed to fetch dashboard data.");const t=[];for(let s=0;s<r.data.length;s++){const e=r.data[s];if(!Array.isArray(e.machine_ool_pressure))throw new Error("invalid ool pressure data");if(!Array.isArray(e.machine_ool_vibration))throw new Error("invalid ool vibration data");t.push({link_up_id:e.link_up_id,link_up:e.link_up,link_up_warn:e.link_up_warn,link_up_alarm:e.link_up_alarm,ool_pressure:e.ool_pressure,ool_vibration:e.ool_vibration,ool_temperature:e.ool_temperature,machine_ool_pressure:e.machine_ool_pressure,machine_ool_vibration:e.machine_ool_vibration,sensor_vibration_connected:e.sensor_vibration_connected,sensor_vibration_total:e.sensor_vibration_total,sensor_pressure_connected:e.sensor_pressure_connected,sensor_pressure_total:e.sensor_pressure_total})}return t}static async GetDashboardLevel3(e){const r=await a.A.fetchAuth(`${s.C}/api/v1/dashboard/realtime/l3?link_up_id=${encodeURIComponent(e)}`);if(200!==r.status)throw new Error("Failed to fetch dashboard data.");const t=[];for(let s=0;s<r.data.length;s++){const e=r.data[s];t.push({machine_id:e.machine_id,machine:e.machine,machine_type:e.machine_type,ool_pressure:e.ool_pressure,ool_vibration:e.ool_vibration,ool_temperature:e.ool_temperature,machine_warn:e.machine_warn,machine_alarm:e.machine_alarm,sensor_vibration_connected:e.sensor_vibration_connected,sensor_pressure_connected:e.sensor_pressure_connected})}return t}}},5764:(e,r,t)=>{t.d(r,{A:()=>a});class s{}s.FilterTable=(e,r)=>{let t=Object.keys(e);for(let s=0;s<t.length;s++){const a=t[s];if(r[a]){if(void 0==e||null==e[a])return!1;if(""!==r[a]&&0==e[a].toString().toLowerCase().includes(r[a].toString().toLowerCase()))return!1}}return!0},s.SortingTable=(e,r,t)=>{if(null!=t&&void 0!=t&&void 0!==e[t]&&void 0!==r[t]){if("string"===typeof e[t]&&"string"===typeof r[t])return e[t].localeCompare(r[t]);if("number"===typeof e[t]&&"number"===typeof r[t])return e[t]-r[t]}return 0},s.FastIsEmpty=e=>{for(const r in e)return!1;return!0};const a=s},6278:(e,r,t)=>{t.d(r,{A:()=>i});var s=t(5043),a=t(5843),n=t(579);function o(e){const{onVisible:r,content:t}=e,{ref:s}=(0,a.Wx)({threshold:.1,triggerOnce:!1,initialInView:!1,onChange:(e,t)=>{e&&r()}});return(0,n.jsx)("tr",{ref:s,children:t})}function i(e){const{tableData:r,rowFunction:t,onRowClick:a,rowsCount:i,rowsIncrement:l}=e,c=i,u=l,[d,_]=(0,s.useState)(c),m=(0,s.useMemo)(()=>{const e=[];for(let s=0;s<r.length;s++){if(s<d-c||s>d)continue;const i=r[s];e.push((0,n.jsxs)(n.Fragment,{children:[s==d?(0,n.jsx)(o,{content:(0,n.jsx)(n.Fragment,{}),onVisible:function(){_(e=>e+u),setTimeout(()=>{var e;null===(e=document.getElementById(`rows_${s}`))||void 0===e||e.scrollIntoView()})}}):(0,n.jsx)(n.Fragment,{}),s==d-c&&0!=s?(0,n.jsx)(o,{content:(0,n.jsx)(n.Fragment,{}),onVisible:function(){_(e=>e-u<c?c:e-u),setTimeout(()=>{var e;null===(e=document.getElementById(`rows_${s}`))||void 0===e||e.scrollIntoView()})}}):(0,n.jsx)(n.Fragment,{}),(0,n.jsx)("tr",{id:`rows_${s}`,style:{whiteSpace:"nowrap"},onClick:()=>{null!=a&&a(i)},children:t(s,i)}),s==r.length-1?(0,n.jsx)("tr",{children:(0,n.jsx)("td",{colSpan:1e3,children:"END OF DATA"})}):(0,n.jsx)(n.Fragment,{})]}))}return e},[d,r]);return(0,s.useEffect)(()=>{_(c)},[r]),m.map(e=>e)}},6757:(e,r,t)=>{t.r(r),t.d(r,{default:()=>g});var s=t(5043),a=t(8270),n=t(8443),o=t(1121),i=t(2573),l=t(5764),c=t(414),u=t(184),d=t(5175),_=t(3216),m=t(6278),h=t(2620),p=t(397),x=t(6361),f=t(2926),b=t(6058),v=t(2087),y=t(579);x.t1.register(x.No,x.FN,x.kc,x.hE,x.PP,x.m_,x.s$),f.d.maintainAspectRatio=!1,f.d.responsive=!0;const g=e=>{let{realtime:r,setRealtime:t,refresh:x,start_date:f,end_date:g,setHandleGenerateExcel:w}=e;const A=(0,s.useContext)(i.A),j=(A.contextAccessToken,A.contextShowAlertFunc),C=A.contextShowLoadingFunc,{machineId:M}=(A.stateShowLoading,(0,_.g)()),k="#fb8500",S="rgba(41, 191, 18, 0.21)",P="rgba(244, 188, 20, 0.28)",R="rgba(213, 14, 81, 0.2)",[F,$]=(0,s.useState)(new Date),[N,I]=(0,s.useState)(!0),[H,D]=(0,s.useState)("minutes_10"),[E,z]=(0,s.useState)("chart"),[G,V]=(0,s.useState)(null),[T,U]=(0,s.useState)("ascending"),[W,B]=(0,s.useState)([]),[L,O]=(0,s.useState)([]),Y=(0,s.useRef)({}),[J,Z]=(0,s.useState)({}),[q,X]=(0,s.useState)({labels:[],datasets:[]}),[K,Q]=(0,s.useState)({}),ee=(0,s.useRef)(null);let re=null,te=!0;const[se,ae]=(0,s.useState)([]),[ne,oe]=(0,s.useState)([]),[ie,le]=(0,s.useState)({}),[ce,ue]=(0,s.useState)({labels:[],datasets:[]}),[de,_e]=(0,s.useState)({}),me=(0,s.useRef)(null);function he(e){const r={};return"all"==H?{all:[...e].toReversed()}:(e.toReversed().forEach(e=>{const t=new Date(e.timestamp),s=new Date(t);s.setMinutes(10*Math.floor(t.getMinutes()/10)),s.setSeconds(0),s.setMilliseconds(0);let a=(0,o.GP)(s,"yyyy-MM-dd HH:00:00");switch(H){case"hour":a=(0,o.GP)(s,"yyyy-MM-dd HH:00:00");break;case"minutes_10":a=(0,o.GP)(s,"yyyy-MM-dd HH:mm:00")}void 0==r[a]?r[a]=[]:r[a].push(e)}),r)}const pe={id:"statusArea",beforeDatasetsDraw(e){var r,t,s,a,n,o,i,l;const c=ee.current,{ctx:u,chartArea:d,scales:_}=e;if(!d||!_.x||!_.y||null==(null===c||void 0===c?void 0:c.pressure_max_alarm)||null==(null===c||void 0===c?void 0:c.pressure_min_alarm)||null==(null===c||void 0===c?void 0:c.pressure_max_warn)||null==(null===c||void 0===c?void 0:c.pressure_min_warn))return;u.save();const m=_.y.min,h=null!==(r=null===c||void 0===c?void 0:c.pressure_min_alarm)&&void 0!==r?r:0,p=_.y.getPixelForValue(m),x=_.y.getPixelForValue(h);u.fillStyle=R,u.fillRect(d.left,Math.min(p,x),d.right-d.left,Math.abs(p-x));const f=null!==(t=null===c||void 0===c?void 0:c.pressure_max_alarm)&&void 0!==t?t:0,b=_.y.max,v=_.y.getPixelForValue(f),y=_.y.getPixelForValue(b);u.fillRect(d.left,Math.min(v,y),d.right-d.left,Math.abs(v-y));const g=null!==(s=null===c||void 0===c?void 0:c.pressure_min_warn)&&void 0!==s?s:0,w=null!==(a=null===c||void 0===c?void 0:c.pressure_max_warn)&&void 0!==a?a:0,A=_.y.getPixelForValue(g),j=_.y.getPixelForValue(w);u.fillStyle=S,u.fillRect(d.left,Math.min(A,j),d.right-d.left,Math.abs(A-j));const C=null!==(n=null===c||void 0===c?void 0:c.pressure_min_alarm)&&void 0!==n?n:0,M=null!==(o=null===c||void 0===c?void 0:c.pressure_min_warn)&&void 0!==o?o:0,k=_.y.getPixelForValue(C),F=_.y.getPixelForValue(M);u.fillStyle=P,u.fillRect(d.left,Math.min(k,F),d.right-d.left,Math.abs(k-F));const $=null!==(i=null===c||void 0===c?void 0:c.pressure_max_warn)&&void 0!==i?i:0,N=null!==(l=null===c||void 0===c?void 0:c.pressure_max_alarm)&&void 0!==l?l:0,I=_.y.getPixelForValue($),H=_.y.getPixelForValue(N);u.fillRect(d.left,Math.min(I,H),d.right-d.left,Math.abs(I-H)),u.restore()}},xe=(e,r)=>{var t;const s=`${Math.floor(r.getMinutes()/10)}0`;let a=(0,o.GP)(r,"yyyy-MM-dd HH:00:00");switch(H){case"hour":a=(0,o.GP)(r,"yyyy-MM-dd HH:00:00");break;case"minutes_10":a=(0,o.GP)(r,`yyyy-MM-dd HH:${s}:00`);break;case"all":a="all"}const n=null!==(t=e[a])&&void 0!==t?t:[];if(!n)return;const i=n.map(e=>(0,o.GP)(e.timestamp,"HH:mm:ss")),l=n.map(e=>e.pressure),c=n.toReversed();ee.current=c[0];const u=Math.min(...l),d=Math.max(...l),_=d-u||1,m=u-.2*_,h=d+.2*_;X({labels:i,datasets:[{label:"Pressure Sensor",data:l,borderColor:k,pointBackgroundColor:k,pointBorderColor:"#ffffff",pointHoverBackgroundColor:"#ffffff",pointHoverBorderColor:k,borderWidth:4,pointRadius:0}]}),Q({responsive:!0,maintainAspectRatio:!1,animation:{duration:800,easing:"easeInOutCubic"},plugins:{legend:{position:"top",labels:{color:"#fbeecc",font:{size:14,weight:500,family:"'Inter', 'Segoe UI', sans-serif"},usePointStyle:!0,pointStyle:"rectRounded"}},tooltip:{backgroundColor:"#1f2937",titleColor:"#f8fafc",bodyColor:"#cbd5e1",padding:12,borderColor:"#0077b6",borderWidth:1,cornerRadius:8,titleFont:{family:"'Inter', sans-serif",size:14,weight:600},bodyFont:{family:"'Inter', sans-serif",size:13}}},scales:{x:{grid:{color:"#0d2b35"},ticks:{color:"#fbeecc",font:{size:12,family:"'Inter', sans-serif"},maxRotation:45,minRotation:0}},y:{grid:{color:"#0d2b35"},ticks:{color:"#fbeecc",font:{size:12,family:"'Inter', sans-serif"},padding:8},min:m,max:h}},layout:{padding:{top:10,bottom:10,left:10,right:10}},elements:{line:{borderJoinStyle:"round"},point:{pointStyle:"circle"}}})},fe=(e,r)=>{var t;return(0,y.jsx)("div",{children:(0,y.jsx)("input",{style:{fontSize:"12px",marginTop:"0.5dvh",width:"150px"},type:"text",value:null!==(t=J[e])&&void 0!==t?t:"",placeholder:`${null!==r&&void 0!==r?r:e} ...`,onChange:r=>{Z(t=>{const s={...t};return s[e]=r.target.value,s})}})})},be=(e,r)=>(0,y.jsxs)("div",{style:{display:"flex",flexDirection:"row",justifyContent:"center",gap:"3px",whiteSpace:"nowrap",cursor:"pointer"},onClick:()=>{V(e),U("ascending"===T?"descending":"ascending")},children:[(0,y.jsx)("div",{children:null!==r&&void 0!==r?r:e}),(0,y.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"0",alignItems:"center",justifyItems:"center"},children:[(0,y.jsx)(u.XhJ,{style:{color:G==e&&"descending"==T?"var(--secondary-color)":"silver",margin:0,padding:0,height:"18px"}}),(0,y.jsx)(u.GOR,{style:{color:G==e&&"ascending"==T?"var(--secondary-color)":"silver",margin:"-18px",padding:0,height:"18px"}})]})]}),ve=(e,r)=>{let t="black",s="400";const{pressure:a,pressure_max_warn:n,pressure_min_warn:i,pressure_max_alarm:l,pressure_min_alarm:c}=r;return void 0!==n&&void 0!==i&&a<n&&a>i&&(t="green",s="bold"),void 0!==n&&void 0!==i&&(a>=n||a<=i)&&(t="orange",s="bold"),void 0!==l&&void 0!==c&&(a>=l||a<=c)&&(t="red",s="bold"),(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("td",{children:e+1}),(0,y.jsx)("td",{children:(0,o.GP)(r.timestamp,"yyyy-MM-dd HH:mm:ss")}),(0,y.jsx)("td",{children:r.pressure}),(0,y.jsx)("td",{children:r.pressure_max_alarm}),(0,y.jsx)("td",{children:r.pressure_max_warn}),(0,y.jsx)("td",{children:r.pressure_min_alarm}),(0,y.jsx)("td",{children:r.pressure_min_warn})]})};(0,s.useEffect)(()=>{(()=>{const e=L.filter(e=>l.A.FilterTable(e,J)).sort((e,r)=>G?"ascending"==T?l.A.SortingTable(e,r,G):l.A.SortingTable(r,e,G):0);B(e)})()},[J,G,T]),(0,s.useEffect)(()=>{(async e=>{e&&C(!0);try{const e=await d.I.GetDashboardLevel4Pressure(Number(M),(0,o.Yq)(f,"yyyy-MM-dd"),(0,o.Yq)(g,"yyyy-MM-dd"));B(e),O(e);const r=he(e);Y.current=r;const t=Object.keys(r);if(t.length>0&&"all"!=H){const e=new Date(t[t.length-1]);$(e),xe(Y.current,e)}else xe(Y.current,F)}catch(r){j(new c.u({message:r instanceof Error?r.message:r.toString(),level:3}))}finally{C(!1)}})(0!=x)},[x]);const ye={id:"statusAreaRealtime",beforeDatasetsDraw(e){var r,t,s,a,n,o,i,l;const c=me.current,{ctx:u,chartArea:d,scales:_}=e;if(!d||!_.x||!_.y)return;if(!c||(0===c.pressure_min_warn||null==c.pressure_min_warn)&&(0===c.pressure_max_warn||null==c.pressure_max_warn)&&(0===c.pressure_min_alarm||null==c.pressure_min_alarm)&&(0===c.pressure_max_alarm||null==c.pressure_max_alarm))return;u.save();const m=_.y.min,h=null!==(r=null===c||void 0===c?void 0:c.pressure_min_alarm)&&void 0!==r?r:0,p=_.y.getPixelForValue(m),x=_.y.getPixelForValue(h);u.fillStyle=R,u.fillRect(d.left,Math.min(p,x),d.right-d.left,Math.abs(p-x));const f=null!==(t=null===c||void 0===c?void 0:c.pressure_max_alarm)&&void 0!==t?t:0,b=_.y.max,v=_.y.getPixelForValue(f),y=_.y.getPixelForValue(b);u.fillRect(d.left,Math.min(v,y),d.right-d.left,Math.abs(v-y));const g=null!==(s=null===c||void 0===c?void 0:c.pressure_min_warn)&&void 0!==s?s:0,w=null!==(a=null===c||void 0===c?void 0:c.pressure_max_warn)&&void 0!==a?a:0,A=_.y.getPixelForValue(g),j=_.y.getPixelForValue(w);u.fillStyle=S,u.fillRect(d.left,Math.min(A,j),d.right-d.left,Math.abs(A-j));const C=null!==(n=null===c||void 0===c?void 0:c.pressure_min_alarm)&&void 0!==n?n:0,M=null!==(o=null===c||void 0===c?void 0:c.pressure_min_warn)&&void 0!==o?o:0,k=_.y.getPixelForValue(C),F=_.y.getPixelForValue(M);u.fillStyle=P,u.fillRect(d.left,Math.min(k,F),d.right-d.left,Math.abs(k-F));const $=null!==(i=null===c||void 0===c?void 0:c.pressure_max_warn)&&void 0!==i?i:0,N=null!==(l=null===c||void 0===c?void 0:c.pressure_max_alarm)&&void 0!==l?l:0,I=_.y.getPixelForValue($),H=_.y.getPixelForValue(N);u.fillRect(d.left,Math.min(I,H),d.right-d.left,Math.abs(I-H)),u.restore()}},ge=(e,r)=>{var t;const s=`${Math.floor(r.getMinutes()/10)}0`;let a=(0,o.GP)(r,"yyyy-MM-dd HH:00:00");switch(H){case"hour":a=(0,o.GP)(r,"yyyy-MM-dd HH:00:00");break;case"minutes_10":a=(0,o.GP)(r,`yyyy-MM-dd HH:${s}:00`);break;case"all":a="all"}const n=null!==(t=e[a])&&void 0!==t?t:[];if(!n)return;const i=n.map(e=>(0,o.GP)(e.timestamp,"HH:mm:ss")),l=n.map(e=>e.pressure),c=n[0];me.current=c;const u=Math.min(...l),d=Math.max(...l),_=d-u||1,m=u-.2*_,h=d+.2*_;ue({labels:i,datasets:[{label:"Pressure Sensor",data:l,borderColor:k,pointBackgroundColor:k,pointBorderColor:"#ffffff",pointHoverBackgroundColor:"#ffffff",pointHoverBorderColor:k,borderWidth:4,pointRadius:0}]}),_e({responsive:!0,maintainAspectRatio:!1,animation:{duration:800,easing:"easeInOutCubic"},plugins:{legend:{position:"top",labels:{color:"#fbeecc",font:{size:14,weight:500,family:"'Inter', 'Segoe UI', sans-serif"},usePointStyle:!0,pointStyle:"rectRounded"}},tooltip:{backgroundColor:"#1f2937",titleColor:"#f8fafc",bodyColor:"#cbd5e1",padding:12,borderColor:"#0077b6",borderWidth:1,cornerRadius:8,titleFont:{family:"'Inter', sans-serif",size:14,weight:600},bodyFont:{family:"'Inter', sans-serif",size:13}}},scales:{x:{grid:{color:"#0d2b35"},ticks:{color:"#fbeecc",font:{size:12,family:"'Inter', sans-serif"},maxRotation:45,minRotation:0}},y:{grid:{color:"#0d2b35"},ticks:{color:"#fbeecc",font:{size:12,family:"'Inter', sans-serif"},padding:8},min:m,max:h}},layout:{padding:{top:10,bottom:10,left:10,right:10}},elements:{line:{borderJoinStyle:"round"},point:{pointStyle:"circle"}}})},we=(e,r)=>{var t;return(0,y.jsx)("div",{children:(0,y.jsx)("input",{style:{fontSize:"12px",marginTop:"0.5dvh",width:"150px"},type:"text",value:null!==(t=ie[e])&&void 0!==t?t:"",placeholder:`${null!==r&&void 0!==r?r:e} ...`,onChange:r=>{le(t=>{const s={...t};return s[e]=r.target.value,s})}})})},Ae=(e,r)=>(0,y.jsxs)("div",{style:{display:"flex",flexDirection:"row",justifyContent:"center",gap:"3px",whiteSpace:"nowrap",cursor:"pointer"},onClick:()=>{V(e),U("ascending"===T?"descending":"ascending")},children:[(0,y.jsx)("div",{children:null!==r&&void 0!==r?r:e}),(0,y.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"0",alignItems:"center",justifyItems:"center"},children:[(0,y.jsx)(u.XhJ,{style:{color:G==e&&"descending"==T?"var(--secondary-color)":"silver",margin:0,padding:0,height:"18px"}}),(0,y.jsx)(u.GOR,{style:{color:G==e&&"ascending"==T?"var(--secondary-color)":"silver",margin:"-18px",padding:0,height:"18px"}})]})]}),je=()=>{if(te)return new Promise((e,r)=>{try{re=new WebSocket(`${n.C}/ws/realtime/pressure`),re.onmessage=e=>{try{const r=JSON.parse(e.data);ae(r.data),oe(r.data)}catch(r){console.log("Invalid response: ",r.message)}},re.onerror=e=>{var r;console.error("WebSocket error:",e),null===(r=re)||void 0===r||r.close()},re.onclose=async()=>{console.log("pressureSocket closed."),console.log("Try reconnecting...");try{await je()}catch(e){console.log("Failed to reconnect")}},re.onopen=()=>{var r;console.log("pressureSocket connected");const t={type:"subscribe",machine_id:M};null===(r=re)||void 0===r||r.send(JSON.stringify(t)),e(!0)}}catch(t){console.log("Error reconnect: ",t),r(!1)}});console.log("canceled")};(0,s.useEffect)(()=>(null!=re&&re.readyState!=WebSocket.CLOSED||(console.log("Connecting ws pressure..."),je()),()=>{null!=re&&(console.log("Disconnecting ws pressure..."),re.close()),te=!1}),[re]),(0,s.useEffect)(()=>{(()=>{const e=ne.filter(e=>l.A.FilterTable(e,ie)).sort((e,r)=>G?"ascending"==T?l.A.SortingTable(e,r,G):l.A.SortingTable(r,e,G):0);ae(e)})()},[ie,G,T]),(0,s.useEffect)(()=>{if(!r)return;if(!N)return;const e=he(se),t=new Date;t.setMinutes(10*Math.floor(t.getMinutes()/10)),$(t),ge(e,t)},[N,r,se,H]),(0,s.useEffect)(()=>{if(!r)return;if(N)return;const e=he(se);ge(e,F)},[N,r,se,F,H]),(0,s.useEffect)(()=>{r||xe(Y.current,F)},[r,Y.current,F]),(0,s.useEffect)(()=>{const e=he(W);Y.current=e;const r=Object.keys(e);if("all"!=H&&r.length>0){const e=new Date(r[r.length-1]);$(e)}else $(new Date)},[r,H]);const Ce=(0,s.useMemo)(()=>"all"==H?"All Data":"hour"==H?(0,o.Yq)(F,"dd MMM yyyy HH:00"):"minutes_10"==H?(0,o.Yq)(F,"dd MMM yyyy HH:mm"):void 0,[F,H]),Me=(e,t)=>{I(!1);const s=new Date(F),a=10*Math.floor(s.getMinutes()/10);"hours"===t?s.setHours(s.getHours()+e,a,0,0):"minutes"===t&&s.setHours(s.getHours(),a+e,0,0),$(s),r||xe(Y.current,s)},ke=(e,r)=>{if(z(e),t(r),V(null),U("ascending"),le({}),"chart"==e)if(r){const e=he(se);ge(e,F)}else xe(Y.current,F)},Se=()=>{if(0==se.length)return j(new c.u({message:"NO DATA!",level:3}));let e=[];for(let n=0;n<se.length;n++){var r,t,s,a;e.push({timestamp:(0,o.GP)("string"===typeof se[n].timestamp?new Date(se[n].timestamp):se[n].timestamp,"yyyy-MM-dd HH:mm:ss"),pressure:`${se[n].pressure}`,pressure_min_warn:`${null!==(r=se[n].pressure_min_warn)&&void 0!==r?r:""}`,pressure_max_warn:`${null!==(t=se[n].pressure_max_warn)&&void 0!==t?t:""}`,pressure_min_alarm:`${null!==(s=se[n].pressure_min_alarm)&&void 0!==s?s:""}`,pressure_max_alarm:`${null!==(a=se[n].pressure_max_alarm)&&void 0!==a?a:""}`})}v.A.export("Pressure Data Realtime",["timestamp","pressure","pressure_min_warn","pressure_max_warn","pressure_min_alarm","pressure_max_alarm"],e)},Pe=()=>{if(0==W.length)return j(new c.u({message:"NO DATA!",level:3}));let e=[];for(let n=0;n<W.length;n++){var r,t,s,a;e.push({timestamp:(0,o.GP)("string"===typeof W[n].timestamp?new Date(W[n].timestamp):W[n].timestamp,"yyyy-MM-dd HH:mm:ss"),pressure:`${W[n].pressure}`,pressure_min_warn:`${null!==(r=W[n].pressure_min_warn)&&void 0!==r?r:""}`,pressure_max_warn:`${null!==(t=W[n].pressure_max_warn)&&void 0!==t?t:""}`,pressure_min_alarm:`${null!==(s=W[n].pressure_min_alarm)&&void 0!==s?s:""}`,pressure_max_alarm:`${null!==(a=W[n].pressure_max_alarm)&&void 0!==a?a:""}`})}v.A.export("Pressure Data",["timestamp","pressure","pressure_min_warn","pressure_max_warn","pressure_min_alarm","pressure_max_alarm"],e)};return(0,s.useEffect)(()=>(w(r?()=>Se:()=>Pe),()=>{w(null)}),[r,se,W]),(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)("div",{className:a.A.cardBodyHeader,children:["chart"===E&&r&&(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)("div",{className:a.A.headerChart,children:[(0,y.jsx)("div",{}),(0,y.jsx)("div",{className:a.A.titleChart,children:Ce}),(0,y.jsxs)("div",{className:a.A.chartButtons,style:{justifyContent:"end"},children:[(0,y.jsx)("button",{onClick:()=>D("hour"),className:"hour"===H?a.A.activeBtn:"",children:"Hour"}),(0,y.jsx)("button",{onClick:()=>D("minutes_10"),className:"minutes_10"===H?a.A.activeBtn:"",children:"Minute"}),(0,y.jsx)("button",{onClick:()=>D("all"),className:"all"===H?a.A.activeBtn:"",children:"All"})]})]}),(0,y.jsxs)("div",{className:a.A.bodyChart,children:[(0,y.jsx)("button",{className:a.A.buttonChart1,style:{borderRadius:"12px 0 0 12px"},onClick:()=>{"hour"==H?Me(-1,"hours"):"minutes_10"==H&&Me(-10,"minutes")},children:(0,y.jsx)(u.ed2,{})}),(0,y.jsx)("div",{className:a.A.wrapperChart,children:(0,y.jsx)(b.N1,{data:ce,options:de,plugins:[ye]})}),(0,y.jsx)("button",{className:a.A.buttonChart2,style:{borderRadius:"0 0 12px 0"},onClick:()=>{"hour"==H?Me(1,"hours"):"minutes_10"==H&&Me(10,"minutes")},children:(0,y.jsx)(u.FDZ,{})})]})]}),"table"===E&&r&&(0,y.jsx)(y.Fragment,{children:(0,y.jsx)("div",{style:{flex:1,overflowY:"auto"},className:"ordering-table",children:(0,y.jsxs)("table",{className:"tableclickcell",children:[(0,y.jsx)("thead",{children:(0,y.jsxs)("tr",{children:[(0,y.jsx)("th",{children:"No"}),(0,y.jsxs)("th",{children:[Ae("timestamp","Waktu"),we("timestamp","Waktu")]}),(0,y.jsxs)("th",{children:[Ae("pressure","Pressure"),we("pressure","Pressure")]}),(0,y.jsxs)("th",{children:[Ae("pressure_max_alarm","Pressure Max Alarm"),we("pressure_max_alarm","Pressure Max Alarm")]}),(0,y.jsxs)("th",{children:[Ae("pressure_max_warn","Pressure Max Warn"),we("pressure_max_warn","Pressure Max Warn")]}),(0,y.jsxs)("th",{children:[Ae("pressure_min_alarm","Pressure Min Alarm"),we("pressure_min_alarm","Pressure Min Alarm")]}),(0,y.jsxs)("th",{children:[Ae("pressure_min_warn","Pressure Min Warn"),we("pressure_min_warn","Pressure Min Warn")]})]})}),l.A.FastIsEmpty(se)?(0,y.jsx)("tbody",{children:(0,y.jsx)("tr",{children:(0,y.jsx)("td",{colSpan:1e3,children:"No Data Available Yet !"})})}):(0,y.jsx)("tbody",{children:(0,y.jsx)(m.A,{tableData:se,rowFunction:ve,rowsCount:250,rowsIncrement:50})})]})})}),"chart"===E&&!r&&(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)("div",{className:a.A.headerChart,children:[(0,y.jsx)("div",{}),(0,y.jsx)("div",{className:a.A.titleChart,children:Ce}),(0,y.jsxs)("div",{className:a.A.chartButtons,style:{justifyContent:"end"},children:[(0,y.jsx)("button",{onClick:()=>D("hour"),className:"hour"===H?a.A.activeBtn:"",children:"Hour"}),(0,y.jsx)("button",{onClick:()=>D("minutes_10"),className:"minutes_10"===H?a.A.activeBtn:"",children:"Minute"}),(0,y.jsx)("button",{onClick:()=>D("all"),className:"all"===H?a.A.activeBtn:"",children:"All"})]})]}),(0,y.jsxs)("div",{className:a.A.bodyChart,children:[(0,y.jsx)("button",{className:a.A.buttonChart1,style:{borderRadius:"12px 0 0 12px"},onClick:()=>{"hour"==H?Me(-1,"hours"):"minutes_10"==H&&Me(-10,"minutes")},children:(0,y.jsx)(u.ed2,{})}),(0,y.jsx)("div",{className:a.A.wrapperChart,children:(0,y.jsx)(b.N1,{data:q,options:K,plugins:[pe]})}),(0,y.jsx)("button",{className:a.A.buttonChart2,style:{borderRadius:"0 0 12px 0"},onClick:()=>{"hour"==H?Me(1,"hours"):"minutes_10"==H&&Me(10,"minutes")},children:(0,y.jsx)(u.FDZ,{})})]})]}),"table"===E&&!r&&(0,y.jsx)(y.Fragment,{children:(0,y.jsx)("div",{style:{flex:1,overflowY:"auto"},className:"ordering-table",children:(0,y.jsxs)("table",{className:"tableclickcell",children:[(0,y.jsx)("thead",{children:(0,y.jsxs)("tr",{children:[(0,y.jsx)("th",{children:"No"}),(0,y.jsxs)("th",{children:[be("timestamp","Waktu"),fe("timestamp","Waktu")]}),(0,y.jsxs)("th",{children:[be("pressure","Pressure"),fe("pressure","Pressure")]}),(0,y.jsxs)("th",{children:[be("pressure_max_alarm","Pressure Max Alarm"),fe("pressure_max_alarm","Pressure Max Alarm")]}),(0,y.jsxs)("th",{children:[be("pressure_max_warn","Pressure Max Warn"),fe("pressure_max_warn","Pressure Max Warn")]}),(0,y.jsxs)("th",{children:[be("pressure_min_alarm","Pressure Min Alarm"),fe("pressure_min_alarm","Pressure Min Alarm")]}),(0,y.jsxs)("th",{children:[be("pressure_min_warn","Pressure Min Warn"),fe("pressure_min_warn","Pressure Min Warn")]})]})}),l.A.FastIsEmpty(W)?(0,y.jsx)("tbody",{children:(0,y.jsx)("tr",{children:(0,y.jsx)("td",{colSpan:1e3,children:"No Data Available Yet !"})})}):(0,y.jsx)("tbody",{children:(0,y.jsx)(m.A,{tableData:W,rowFunction:ve,rowsCount:250,rowsIncrement:50})})]})})})]}),(0,y.jsxs)("div",{className:a.A.cardBodyFooter,children:[(0,y.jsxs)("div",{className:a.A.footerLeft,children:[(0,y.jsxs)("button",{className:`${a.A.buttonFooter} ${"chart"===E&&r?a.A.active:""}`,onClick:()=>{ke("chart",!0)},children:[(0,y.jsx)(h.kk8,{}),(0,y.jsx)("span",{className:a.A.tooltipText,children:"Realtime Chart"})]}),(0,y.jsxs)("button",{className:`${a.A.buttonFooter} ${"table"===E&&r?a.A.active:""}`,onClick:()=>{ke("table",!0)},children:[(0,y.jsx)(p.ZIs,{}),(0,y.jsx)("span",{className:a.A.tooltipText,children:"Realtime Table"})]})]}),(0,y.jsx)("div",{className:a.A.footerMid,children:"chart"===E&&r&&(0,y.jsxs)("div",{className:a.A.switchGroup,children:[(0,y.jsx)("label",{htmlFor:"auto",children:"Auto"}),(0,y.jsxs)("label",{className:a.A.switch,children:[(0,y.jsx)("input",{type:"checkbox",id:"auto",checked:N,onChange:()=>{I(e=>!e)}}),(0,y.jsx)("span",{className:a.A.slider})]})]})}),(0,y.jsxs)("div",{className:a.A.footerRight,children:[(0,y.jsxs)("button",{className:`${a.A.buttonFooter} ${"chart"!==E||r?"":a.A.active}`,onClick:()=>{ke("chart",!1)},children:[(0,y.jsx)(u.YYR,{}),(0,y.jsx)("span",{className:a.A.tooltipText,children:"Chart"})]}),(0,y.jsxs)("button",{className:`${a.A.buttonFooter} ${"table"!==E||r?"":a.A.active}`,onClick:()=>{ke("table",!1)},children:[(0,y.jsx)(u.ist,{}),(0,y.jsx)("span",{className:a.A.tooltipText,children:"Table"})]})]})]})]})}}}]);
//# sourceMappingURL=757.223a3b33.chunk.js.map