"use strict";(self.webpackChunknagamas_frontend=self.webpackChunknagamas_frontend||[]).push([[781],{1779:(e,a,r)=>{r.r(a),r.d(a,{default:()=>u});var t=r(5043),n=r(2573),s=r(3216),o=r(3950),i=r(414),c=r(6094),l=r(5175),_=r(1121);const d=r.p+"static/media/vibration_image.b8ac7963da7300d79b76.png";var m=r(8557),h=r(579);const u=e=>{let{realtime:a,refresh:r,filterDate:u,onFilterDateChange:p}=e;const v=(0,t.useContext)(n.A),b=v.version,w=v.contextAccessToken,y=v.contextShowAlertFunc,f=v.contextShowLoadingFunc,A=(v.stateShowLoading,(0,s.Zp)()),x=(0,s.zy)(),{linkUpId:g}=(0,s.g)(),{link_up:j}=x.state||{},[C,N]=(0,t.useState)({}),[k,$]=(0,t.useState)({}),[O,E]=(0,t.useState)({}),I=async()=>{try{if(g){let e=[];if(a)e=await l.r.GetDashboardLevel3(Number(g)),p({start_date:new Date,end_date:new Date}),localStorage.removeItem("cache");else{const r=(0,_.Yq)(u.start_date,"yyyy-MM-dd"),t=(0,_.Yq)(u.end_date,"yyyy-MM-dd");e=await l.I.GetDashboardLevel3(Number(g),r,t),localStorage.setItem("cache",JSON.stringify({...u,realtime:a}))}const r={},t={};for(let a=0;a<e.length;a++){const n=e[a];r[`${n.machine_id}`]=n;const s=Object.values(C).flat().find(e=>e.machine_id===n.machine_id);if(!s)continue;const o=s.machine_type;t[o]||(t[o]={link_up_id:j.link_up_id,link_up:j.link_up,ool_pressure:0,ool_vibration:0,ool_temperature:0,machine_ool:[]}),t[o].ool_pressure+=n.ool_pressure,t[o].ool_vibration+=n.ool_vibration,t[o].ool_temperature+=n.ool_temperature,(n.ool_pressure>s.machine_alarm||n.ool_vibration>s.machine_alarm||n.ool_temperature>s.machine_alarm)&&t[o].machine_ool.push(s.machine_id)}for(const a in t)t[a].machine_ool=Array.from(new Set(t[a].machine_ool));E(t),$(r)}}catch(e){y(new i.u({message:e instanceof Error?e.message:e.toString(),level:3}))}},L=async()=>{if(a)void 0!=b.server&&await I();else{T(),f(!0);const e=[];void 0!=b.server&&e.push(I());try{await Promise.any(e)}catch{}f(!1)}},T=()=>{E(e=>{const a={};for(const r in e)a[r]={...e[r],ool_pressure:0,ool_vibration:0,ool_temperature:0,machine_ool:[]};return a}),$({})},D=(e,a)=>{const r=null!==e&&void 0!==e?e:0;let t="";return r>a.machine_warn&&(t=c.A.warningBackground),r>a.machine_alarm&&(t=c.A.dangerBackground),t};return(0,t.useEffect)(()=>{if(Object.keys(C).length>0&&(L(),a)){let e=null;const a=()=>{e=setTimeout(async()=>{await L(),a()},3e3)};return a(),()=>{null!=e&&clearTimeout(e)}}},[w,a,g,C,r]),(0,t.useEffect)(()=>{(async()=>{0==Object.keys(C).length&&f(!0);try{const e=await o.t.GetAllMachine(g),a={};for(let r=0;r<e.length;r++)void 0==a[e[r].machine_type]&&(a[e[r].machine_type]=[]),a[e[r].machine_type].push(e[r]);N(a)}catch(e){y(new i.u({message:e instanceof Error?e.message:e.toString(),level:3}))}finally{0==Object.keys(C).length&&f(!1)}})()},[]),0===Object.keys(C).length?(0,h.jsx)("div",{className:c.A.noData,children:(0,h.jsxs)("div",{className:"flex flex-col items-center justify-center text-gray-400",children:[(0,h.jsx)("img",{src:m,alt:"no_data_img",width:140,height:140}),(0,h.jsx)("p",{className:"mt-2 text-xl font-medium",children:"No Data Available"})]})}):(0,h.jsx)("div",{className:c.A.cardWrapper,style:{gridTemplateColumns:1===Object.keys(C).length?"1fr":"repeat(2, 1fr)",gridAutoRows:Object.keys(C).length<=2?"1fr":void 0},children:Object.keys(C).map(e=>{var a,r,t,n,s,o;const i=C[e];return(0,h.jsxs)("div",{className:c.A.cardParent,children:[(0,h.jsxs)("div",{className:c.A.cardParentHeader,children:[(0,h.jsxs)("div",{className:c.A.titleHeader,children:[e," Overall"]}),(0,h.jsxs)("div",{className:c.A.bodyHeader,children:[(0,h.jsxs)("div",{className:c.A.bodyHeaderLeft,children:[(0,h.jsxs)("div",{className:c.A.itemHeaderLeft,children:[(0,h.jsx)("div",{children:"Total Machine OOL"}),(0,h.jsx)("div",{className:c.A.oolNumber,children:null!==(a=null===(r=O[e])||void 0===r||null===(t=r.machine_ool)||void 0===t?void 0:t.length)&&void 0!==a?a:0})]}),(0,h.jsxs)("div",{className:c.A.itemHeaderLeft,children:[(0,h.jsx)("div",{children:"Total OOL Pressure"}),(0,h.jsx)("div",{className:c.A.oolNumber,children:null===(n=O[e])||void 0===n?void 0:n.ool_pressure})]}),(0,h.jsxs)("div",{className:c.A.itemHeaderLeft,children:[(0,h.jsx)("div",{children:"Total OOL Vibration"}),(0,h.jsx)("div",{className:c.A.oolNumber,children:null===(s=O[e])||void 0===s?void 0:s.ool_vibration})]}),(0,h.jsxs)("div",{className:c.A.itemHeaderLeft,children:[(0,h.jsx)("div",{children:"Total OOL Temperature"}),(0,h.jsx)("div",{className:c.A.oolNumber,children:null===(o=O[e])||void 0===o?void 0:o.ool_temperature})]})]}),(0,h.jsx)("div",{className:c.A.bodyHeaderRight,children:(0,h.jsx)("div",{className:c.A.imgWrapper,children:(0,h.jsx)("img",{src:d,alt:"vibration image",className:c.A.imgHeader})})})]})]}),(0,h.jsx)("div",{className:c.A.cardParentBodyWrapper,children:(0,h.jsx)("div",{className:c.A.cardParentBody,style:{gridTemplateColumns:Object.keys(C).length>1?"repeat(2, 1fr)":"repeat(4, 1fr)"},children:i.map(e=>{const a=k[`${e.machine_id}`];return(0,h.jsxs)("div",{className:c.A.gridItem,onClick:()=>A(`/dashboard/l4/${e.machine_id}`,{state:{dashboard_type:"sensor",machine:e.machine}}),children:[(0,h.jsx)("div",{className:c.A.gridTitle,children:(0,h.jsx)("div",{className:c.A.gridTitleText,children:e.machine})}),(0,h.jsx)("div",{className:c.A.gridContent,children:void 0!=a?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)("div",{className:`${c.A.gridContentText} ${D(a.ool_pressure,e)}`,children:[(0,h.jsx)("div",{children:"OOL Pressure"}),(0,h.jsx)("div",{children:a.ool_pressure})]}),(0,h.jsxs)("div",{className:`${c.A.gridContentText} ${D(a.ool_vibration,e)}`,children:[(0,h.jsx)("div",{children:"OOL Vibration"}),(0,h.jsx)("div",{children:a.ool_vibration})]}),(0,h.jsxs)("div",{className:`${c.A.gridContentText} ${D(a.ool_temperature,e)}`,style:{gridColumn:"span 2"},children:[(0,h.jsx)("div",{children:"OOL Temperature"}),(0,h.jsx)("div",{children:a.ool_temperature})]})]}):(0,h.jsx)(h.Fragment,{})}),(0,h.jsx)("div",{className:c.A.gridFooter,children:void 0!=a&&(0,h.jsxs)(h.Fragment,{children:[void 0!==a.sensor_vibration_connected&&null!==a.sensor_vibration_connected&&(0,h.jsxs)("div",{className:c.A.gridFooterItem,children:[(0,h.jsx)("p",{children:"Vibration"}),(0,h.jsx)("div",{className:`${c.A.footerIndicator} ${a.sensor_vibration_connected?c.A.connected:c.A.disconnected}`})]}),(0,h.jsx)("div",{style:{width:"3px",height:"80%",backgroundColor:"#2d545e"}}),void 0!==a.sensor_pressure_connected&&null!==a.sensor_pressure_connected&&(0,h.jsxs)("div",{className:c.A.gridFooterItem,children:[(0,h.jsx)("p",{children:"Pressure"}),(0,h.jsx)("div",{className:`${c.A.footerIndicator} ${a.sensor_pressure_connected?c.A.connected:c.A.disconnected}`})]})]})})]},e.machine_id)})})})]},e)})})}},3950:(e,a,r)=>{r.d(a,{t:()=>s});var t=r(8443),n=r(2340);class s{static async GetAllMachine(e){let a=`${t.C}/api/v1/machine`;null!=e&&(a+=`?link_up_id=${e}`);const r=await n.A.fetchAuth(a);if(200!==r.status)throw new Error(r.message);const s=Array.isArray(r.data)?r.data:[],o=[];for(let t=0;t<s.length;t++)o.push({machine_id:s[t].machine_id,machine:s[t].machine,machine_warn:s[t].machine_warn,machine_alarm:s[t].machine_alarm,link_up:s[t].link_up,machine_type:s[t].machine_type,gateway_host:s[t].gateway_host,gateway_port:s[t].gateway_port,pressure_slave_id:s[t].pressure_slave_id,vibration_slave_id:s[t].vibration_slave_id});return o}static async AddMachine(e){let a=await n.A.fetchAuth(`${t.C}/api/v1/machine`,{method:"POST",body:JSON.stringify({...e}),headers:{"Content-Type":"application/json"}});if(200!==a.status)throw new Error(a.message);return a}static async UpdateMachine(e,a){let r=await n.A.fetchAuth(`${t.C}/api/v1/machine`,{method:"PATCH",body:JSON.stringify({machine_id:e,fields:a}),headers:{"Content-Type":"application/json"}});if(200!==r.status)throw new Error(r.message);return r}static async DeleteMachine(e){let a=await n.A.fetchAuth(`${t.C}/api/v1/machine`,{method:"DELETE",body:JSON.stringify({machine_id:e}),headers:{"Content-Type":"application/json"}});if(200!==a.status)throw new Error(a.message);return a}}},5175:(e,a,r)=>{r.d(a,{I:()=>s,r:()=>o});var t=r(8443),n=r(2340);class s{static async GetDashboardLevel1(e,a){const r=await n.A.fetchAuth(`${t.C}/api/v1/dashboard/l1?start_date=${encodeURIComponent(e)}&end_date=${encodeURIComponent(a)}`);if(200!==r.status)throw new Error("Failed to fetch dashboard data.");const s=[];for(let t=0;t<r.data.length;t++){const e=r.data[t];if(!Array.isArray(e.machine_ool_pressure))throw new Error("invalid ool pressure data");if(!Array.isArray(e.machine_ool_vibration))throw new Error("invalid ool vibration data");s.push({business_unit_id:e.business_unit_id,business_unit:e.business_unit,business_unit_warn:e.business_unit_warn,business_unit_alarm:e.business_unit_alarm,ool_pressure:e.ool_pressure,ool_vibration:e.ool_vibration,ool_temperature:e.ool_temperature,machine_ool_pressure:e.machine_ool_pressure,machine_ool_vibration:e.machine_ool_vibration,sensor_vibration_connected:e.sensor_vibration_connected,sensor_vibration_total:e.sensor_vibration_total,sensor_pressure_connected:e.sensor_pressure_connected,sensor_pressure_total:e.sensor_pressure_total})}return s}static async GetDashboardLevel2(e,a,r){const s=await n.A.fetchAuth(`${t.C}/api/v1/dashboard/l2?business_unit_id=${encodeURIComponent(e)}&start_date=${encodeURIComponent(a)}&end_date=${encodeURIComponent(r)}`);if(200!==s.status)throw new Error("Failed to fetch dashboard data.");const o=[];for(let t=0;t<s.data.length;t++){const e=s.data[t];if(!Array.isArray(e.machine_ool_pressure))throw new Error("invalid ool pressure data");if(!Array.isArray(e.machine_ool_vibration))throw new Error("invalid ool vibration data");o.push({link_up_id:e.link_up_id,link_up:e.link_up,link_up_warn:e.link_up_warn,link_up_alarm:e.link_up_alarm,ool_pressure:e.ool_pressure,ool_vibration:e.ool_vibration,ool_temperature:e.ool_temperature,machine_ool_pressure:e.machine_ool_pressure,machine_ool_vibration:e.machine_ool_vibration,sensor_vibration_connected:e.sensor_vibration_connected,sensor_vibration_total:e.sensor_vibration_total,sensor_pressure_connected:e.sensor_pressure_connected,sensor_pressure_total:e.sensor_pressure_total})}return o}static async GetDashboardLevel3(e,a,r){const s=await n.A.fetchAuth(`${t.C}/api/v1/dashboard/l3?link_up_id=${encodeURIComponent(e)}&start_date=${encodeURIComponent(a)}&end_date=${encodeURIComponent(r)}`);if(200!==s.status)throw new Error("Failed to fetch dashboard data.");const o=[];for(let t=0;t<s.data.length;t++){const e=s.data[t];o.push({machine_id:e.machine_id,machine:e.machine,machine_warn:e.machine_warn,machine_alarm:e.machine_alarm,machine_type:e.machine_type,ool_pressure:e.ool_pressure,ool_vibration:e.ool_vibration,ool_temperature:e.ool_temperature,sensor_vibration_connected:e.sensor_vibration_connected,sensor_pressure_connected:e.sensor_pressure_connected})}return o}static async GetDashboardLevel4Pressure(e,a,r){let s=await n.A.fetchAuth(`${t.C}/api/v1/dashboard/pressure/l4?machine_id=${encodeURIComponent(e)}&start_date=${encodeURIComponent(a)}&end_date=${encodeURIComponent(r)}`);if(200!==s.status)throw new Error(s.message);const o=Array.isArray(s.data)?s.data:[],i=[];for(let t=0;t<o.length;t++)i.push({pressure:o[t].pressure,pressure_max_alarm:o[t].pressure_max_alarm,pressure_max_warn:o[t].pressure_max_warn,pressure_min_alarm:o[t].pressure_min_alarm,pressure_min_warn:o[t].pressure_min_warn,timestamp:o[t].timestamp});return i}static async GetDashboardLevel4Vibration(e,a,r){let s=await n.A.fetchAuth(`${t.C}/api/v1/dashboard/vibration/l4?machine_id=${encodeURIComponent(e)}&start_date=${encodeURIComponent(a)}&end_date=${encodeURIComponent(r)}`);if(200!==s.status)throw new Error(s.message);const o=Array.isArray(s.data)?s.data:[],i=[];for(let t=0;t<o.length;t++)i.push({x:o[t].x,x_base:o[t].x_base,x_warn:o[t].x_warn,x_alarm:o[t].x_alarm,z:o[t].z,z_base:o[t].z_base,z_warn:o[t].z_warn,z_alarm:o[t].z_alarm,x_acc:o[t].x_acc,x_acc_base:o[t].x_acc_base,x_acc_warn:o[t].x_acc_warn,x_acc_alarm:o[t].x_acc_alarm,z_acc:o[t].z_acc,z_acc_base:o[t].z_acc_base,z_acc_warn:o[t].z_acc_warn,z_acc_alarm:o[t].z_acc_alarm,temp:o[t].temp,temp_warn:o[t].temp_warn,temp_alarm:o[t].temp_alarm,timestamp:o[t].timestamp});return i}}class o{static async GetDashboardLevel1(){const e=await n.A.fetchAuth(`${t.C}/api/v1/dashboard/realtime/l1`);if(200!==e.status)throw new Error("Failed to fetch dashboard data.");const a=[];for(let r=0;r<e.data.length;r++){const t=e.data[r];if(!Array.isArray(t.machine_ool_pressure))throw new Error("invalid ool pressure data");if(!Array.isArray(t.machine_ool_vibration))throw new Error("invalid ool vibration data");const n=t.machine_ool_pressure.concat(t.machine_ool_vibration);Array.from(new Set(n));a.push({business_unit_id:t.business_unit_id,business_unit:t.business_unit,business_unit_warn:t.business_unit_warn,business_unit_alarm:t.business_unit_alarm,ool_pressure:t.ool_pressure,ool_vibration:t.ool_vibration,ool_temperature:t.ool_temperature,machine_ool_pressure:t.machine_ool_pressure,machine_ool_vibration:t.machine_ool_vibration,sensor_vibration_connected:t.sensor_vibration_connected,sensor_vibration_total:t.sensor_vibration_total,sensor_pressure_connected:t.sensor_pressure_connected,sensor_pressure_total:t.sensor_pressure_total})}return a}static async GetDashboardLevel2(e){const a=await n.A.fetchAuth(`${t.C}/api/v1/dashboard/realtime/l2?business_unit_id=${encodeURIComponent(e)}`);if(200!==a.status)throw new Error("Failed to fetch dashboard data.");const r=[];for(let t=0;t<a.data.length;t++){const e=a.data[t];if(!Array.isArray(e.machine_ool_pressure))throw new Error("invalid ool pressure data");if(!Array.isArray(e.machine_ool_vibration))throw new Error("invalid ool vibration data");r.push({link_up_id:e.link_up_id,link_up:e.link_up,link_up_warn:e.link_up_warn,link_up_alarm:e.link_up_alarm,ool_pressure:e.ool_pressure,ool_vibration:e.ool_vibration,ool_temperature:e.ool_temperature,machine_ool_pressure:e.machine_ool_pressure,machine_ool_vibration:e.machine_ool_vibration,sensor_vibration_connected:e.sensor_vibration_connected,sensor_vibration_total:e.sensor_vibration_total,sensor_pressure_connected:e.sensor_pressure_connected,sensor_pressure_total:e.sensor_pressure_total})}return r}static async GetDashboardLevel3(e){const a=await n.A.fetchAuth(`${t.C}/api/v1/dashboard/realtime/l3?link_up_id=${encodeURIComponent(e)}`);if(200!==a.status)throw new Error("Failed to fetch dashboard data.");const r=[];for(let t=0;t<a.data.length;t++){const e=a.data[t];r.push({machine_id:e.machine_id,machine:e.machine,machine_type:e.machine_type,ool_pressure:e.ool_pressure,ool_vibration:e.ool_vibration,ool_temperature:e.ool_temperature,machine_warn:e.machine_warn,machine_alarm:e.machine_alarm,sensor_vibration_connected:e.sensor_vibration_connected,sensor_pressure_connected:e.sensor_pressure_connected})}return r}}},8557:(e,a,r)=>{e.exports=r.p+"static/media/no_data_image.02a3677960f597d7be3c.png"}}]);
//# sourceMappingURL=781.1dd0b0f3.chunk.js.map